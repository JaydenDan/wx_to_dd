import re
import os
from dotenv import load_dotenv
from loguru import logger
from src.utils.logger import setup_logger

load_dotenv()
# setup_logger() # 初始化日志配置

# 用户配置项
WECHAT_LISTEN_TARGET = os.getenv("WECHAT_LISTEN_TARGET")
WECHAT_LISTEN_ROOM_WXID = os.getenv("WECHAT_LISTEN_ROOM_WXID")
DINGTALK_LOCAL_SEND_TARGET = os.getenv("DINGTALK_LOCAL_SEND_TARGET")
DINGTALK_HOOK_SEND_TARGET = os.getenv("DINGTALK_HOOK_SEND_TARGET")
DINGTALK_HOOK_URL = os.getenv("DINGTALK_HOOK_URL")
DINGTALK_SEND_METHOD = os.getenv("DINGTALK_SEND_METHOD")
DINGTALK_STANDBY = os.getenv("DINGTALK_STANDBY", "0") # 默认 0
SYSTEM_ENV = os.getenv("SYSTEM_ENV")
LOG_LEVEL = os.getenv("LOG_LEVEL", "INFO")
SCREENSHOT_DELAY = float(os.getenv("SCREENSHOT_DELAY", "0.5"))
TEXT_PASTE_WAITING = float(os.getenv("TEXT_PASTE_WAITING", "0.1"))  
SCREENSHOT_PASTE_WAITING = float(os.getenv("SCREENSHOT_PASTE_WAITING", "0.6"))

# 正则表达式
SHENGYANG_TRAIN = re.compile('(?<![a-zA-Z0-9])(g424[5678]|g498|g497|g1212|g1213|g1214|g1211|g1222|g1223|g1224|g1221|g1226|g1227|g1228|g1225|g1230|g1231|g1232|g1229|g1234|g1235|g1236|g1233|g1251|g1254|g1252|g1253|g1256|g1257|g1258|g1255|g1266|g1267|g1268|g1265|g1272|g1273|g1274|g1271|g1284|g1281|g1282|g1283|g1292|g1289|g1290|g1291|g1293|g1296|g1294|g1295|g2622|g2623|g2624|g2621|g2625|g2628|g2626|g2627|g2630|g2631|g2632|g2629|g2652|g2653|g2654|g2651|g3498|g3495|g3496|g3497|g912|g915|g956|g917|g964|g957|g966|g961|g972|g965|g920|g925|g976|g929|g924|g923|g978|g999|g980|g991|g993|g990|g995|g3513|g3516|g3523|g3522|g3521|g3524|g3531|g3530|g3501|g3504|g3507|g3506|g3537|g3540|g3515|g3514|g3525|g3528|g3539|g3538|g958|g975|g960|g973|g3601|g3604|g3603|g3602|g3650|g3649|g3652|g3651|g3654|g3655|g3656|g3653|g3662|g3665|g3666|g3661|g3670|g3673|g3674|g3677|g3678|g3669|g3692|g3691|g3697|g3696|g3695|g3698|g47|g50|g707|g716|g709|g720|g711|g722|g701|g710|g725|g706|g719|g730|g721|g732|g763|g764|g771|g772|g788|g785|g786|g787|d12|d13|d16|d17|d118|d115|d116|d117|d119|d120|d121|d122|d126|d123|d124|d125|d130|d127|d128|d129|d164|d161|d162|d163|z12|z13|z14|z11|z62|z61|z102|z103|z104|z101|z118|z117|z188|z185|z186|z187|z194|z191|z192|z193|z212|z211|z328|z326|z327|z384|z385|z386|z383|z396|z397|z398|z518|z515|z516|z517|t122|t123|t124|t121|t129|t130|t131|t134|t132|t133|t302|t303|t304|t301|t369|t368|t370|t367|k54|k53|k58|k55|k56|k57|k96|k95|k130|k129|k128|k125|k126|k127|k190|k187|k188|k189|k335|k338|k336|k337|k346|k347|k348|k345|k388|k385|k386|k387|k430|k429|k549|k550|k581|k580|k579|k582|k668|k665|k666|k667|k683|k682|k681|k684|k715|k718|k716|k717|k958|k955|k956|k957|k961|k960|k962|k959|k972|k969|k970|k971|k1024|k1023|k1056|k1053|k1054|k1055|k1190|k1189|k1227|k1228|k1229|k1230|k1241|k1244|k1242|k1243|k1262|k1259|k1260|k1261|k1458|k1455|k1456|k1457|k1520|k1517|k1518|k1519|k1534|k1533|k1572|k1573|k1574|k1571|k1820|k1817|k1818|k1819|k1986|k1983|k1984|k1985|k2048|k2045|k2046|k2047|k2051|k2052|k2288|k2285|k2286|k2287|k2388|k2385|k2386|k2387|k2550|k2549|k2560|k2559|k2623|k2624|k4017|g8001|g8010|g8017|g8006|g8013|g8024|g8005|g8012|g8019|g8004|g8011|g8020|g8007|g8016|g8023|g8002|g8009|g8018|g8008|g8015|g8039|g8038|g8037|g8040|g8032|g8033|g8035|g8041|g8046|g8049|g8054|g8057|g8062|g8043|g8045|g8050|g8053|g8058|g8048|g8051|g8056|g8059|g8066|g8042|g8047|g8052|g8055|g8060|g8061|g8063|g8064|g8065|g8067|g8068|g8070|g8069|g8071|g8072|g8081|g8082|g8092|g8104|g8101|g8103|g8102|g8108|g8105|g8106|g8107|g8125|g8126|g8127|g8128|g8130|g8147|g8146|g8148|g8145|g8183|g8186|g8185|g8184|g8171|g7399|g7400|g7570|g7569|d7603|d7606|d7615|d7616|d7625|d7627|d7628|d7607|d7620|d7610|d7619|d7629|d7630|d7631|d7632|d7667|d7668|d7669|d7670|d7604|d7611|d7612|d7623|d7624|d7633|d7613|d7638|d7640|d7651|d7652|d7672|d7731|d7734|d7733|d7732|d7747|d7750|d7749|d7748|d7741|d7740|d7743|d7746|d7737|d7736|d7751|d7754|d7757|d7756|d7755|d7758|d7753|d7742|d7711|d7712|d7713|d7718|d7717|d7716|d7715|d7720|d7724|d7761|d7762|d7763|d7764|d7768|d7765|d7766|d7767|d7788|d7785|d7791|d7794|d7792|d7793|d7796|d7797|d7795|d7798|d8080|d8079|d8083|d8082|d8081|d8084|d8085|d8088|d8087|d8086|d8092|d8089|d8090|d8091|d8093|d6096|d6095|c1003|c1008|c1019|c1018|C1027|c1002|c1011|c1010|c1021|c1004|c1045|c1046|c1047|c1048|c1015|c1020|c1025|c1007|c1006|c1017|c1016|c1009|c1012|c1023|c1026|c1001|c1028|c1005|c1024|c1037|c1041|c1042|c1043|c1040|c1049|c1050|c1201|c1204|c1207|c1210|c1213|c1216|c1219|c1222|c1225|c1228|c1203|c1206|c1209|c1212|c1215|c1218|c1221|c1224|c1227|c1230|c1233|c1202|c1211|c1205|c1208|c1252|c1217|c1220|c1223|c1226|c1229|c1232|c1243|c1248|c1250|c1264|c1104|c1101|c1106|c1107|c1112|c1109|c1130|c1131|c1102|c1103|c1120|c1117|c1110|c1111|c1108|c1105|c1118|c1119|c1116|c1113|c1166|C1165|c1154|c1151|c1160|c1161|c1156|c1157|c1162|c1159|c1152|c1153|c1158|c1155|c1174|c1171|c1172|c1173|c1176|c1177|c1178|c1175|c1180|c1181|c1303|c1302|c1301|c1304|c1307|c1306|c1305|c1308|c1311|c1310|c1309|c1312|c1315|c1314|c1313|c1316|c1319|c1318|c1317|c1320|c1327|c1326|c1325|c1328|c516|c515|c511|c504|c503|c508|c517|c518|c527|c528|c505|c506|c519|c502|c507|c510|c529|c530|c521|c522|c509|c512|c531|c532|c533|c534|c545|c546|c547|c548|c6271|c6272|c6429|c6428|z5001|z5002|t5301|t5302|t5303|t5306|t5687|t5688|k7305|k7306|k7322|k7321|k7333|k7334|k7385|k7386|k7394|k7391|k7392|k7393|k7425|k7426|k7501|k7502|k7507|k7508|k7522|k7521|k7527|k7530|k7528|k7529|k7533|k7534|k7535|k7536|k7537|k7538|k7541|k7542|k7565|k7566|k7571|k7572|k7595|k7596|k7723|k7724|k7717|k7718|4230|4229|4245|4246|4318|4319|4320|4317|4325|4326|4327|4328|4330|4347|4348|4349|4350|4357|4356|4355|4358|4370|4367|4368|4369)(?![a-zA-Z0-9])'
                            ,re.I)
SHENYANG_STATION = re.compile('辽宁|东北(?!侧)(?!(方位|方向))|鲅鱼圈|延边|长山屯|沈局|城子坦|大连|滦县|登沙河|金州|旅顺|普湾|熊岳城|营口|梅河口|周水子|庄河|白水井|大石桥|瓦房店|吉林|哈达湾|桦甸|蛟河|九台|口前|龙潭山|盘石|舒兰|沈阳|苏家屯|裕国|辽阳|(?<!马)鞍山|海城|铁岭|开原|昌图|抚顺|清原|西丰|扶余|龙嘉|农安|双阳|榆树|长春|公主岭|德惠|四平|兴城|新立屯|朝阳|盘锦|建平|牛河梁|台安|黑山|辽中|建昌|凌源|女儿河|宁城|新民|喀左|大虎山|义县|北票|阜新|山海关|平庄西|葫芦岛|锦州|沟帮子|丹东|本溪|八里甸子|大孤山|石桥子|凤城|宽甸|安平|南芬|通远堡|五女山|小市|凤凰城|五龙背|奈曼|双辽|八仙筒|舍伯吐|保康|通辽|白音胡硕|霍林郭勒|赤峰|彰武|石岭|通化|集安|辽源|江源|东丰|三源浦|白山|山城镇|松江河|延吉|安图|图们|和龙|龙井|珲春|敦化|长白山|白城|松原|洮南|甘期卡|大安|镇贲|开通|镇西|索伦|阿尔山')
SHENYANG_DELETE = re.compile(
    r'哈局.{0,5}乘警?支队[^\s\n]*'                                                        # 匹配“哈局XX乘警支队”及其后缀（如姓名代号等），并清理后缀
    r'|^.{1,3}局.{1,3}乘.?支队[^\s\n]*'                                                 # 匹配“X局X处乘支队”格式的敏感单位，支持1~3字符模糊
    r'|^.{2,5}站派出所[^\s\n]*'                                                         # 匹配“X站派出所”格式及其附加内容
    r'|^.{1,3}局.{1,5}处.{0,8}所[^\s\n]*'                                               # 匹配“X局X处X所”格式单位及后缀
    r'|^.{0,3}乘.?支队[^\s\n]*'                                                         # 匹配“乘支队”、“乘警支队”等简化形式单位
    r'|^.{0,5}?沈阳(铁路公安)?局?(锦州|通辽|白城|大连|长春)处?[a-zA-Z]{0,5}[^\s\n]*'         # 匹配沈阳局下辖各地（锦州等）+附加字母后缀（如wyf），并删除
    r'|(报送|上报)?单.?位[：:][^\s\n]*[ ]?'                                              # 匹配“报送单位:xxx”，清除单位信息到空格为止
    r'|((报送|上报)?单.?位[：:]|昵称|（).{1,5}(铁路公安)?局'                                # 匹配“报送单位/昵称/（X局...”类前缀
    r'(.{1,5}处)?([a-zA-Z]{2,3}|.{1,5}所|.{0,3}值班\d{0,3})?[ ]?'                       # 匹配处/所/值班等附属单位及其后缀代号
    r'|^.{0,8}局(.{1,5}处)?([a-zA-Z]{2,3}|.{1,5}所|.{0,3}值班\d{0,3})?[ ]?'              # 匹配简短的“X局X处/所/值班”单位表达式
    r'|(北京|哈(尔滨)?|沈阳|呼和?(浩特)?|郑州|太原|济南|上海|广州|南宁|成都|兰州|乌(鲁木齐)?|南昌|昆明|青藏|武汉|西安)'  
    r'(铁路公安)?局.{1,5}处([a-zA-Z]{2,3}|.{1,5}所|.{0,3}值班\d{0,3}|丁思雨)?'              # 匹配全国主要铁路公安局及处/所/值班等单位（含丁思雨等个例）
)
SHENYANG_FILTER = re.compile('车迷|铁路摄影')
URL_PATTERN = re.compile(r'https?://[^\s<>"\']+')
IP_PATTERN = re.compile(r'\bhttps?:\/\/[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:\/[-a-zA-Z0-9()@:%_\+.~#?&//=]*)?')
NUMBER_PATTERN = re.compile(r'\d+\.\d+|\s+[A-Za-z0-9@:/.]+\s*$')
MSG_SUB_PATTERN = re.compile(r'.*?:\n')
ADDRESS_LIST = ["辽宁", "吉林", "内蒙古"]
MSG_ATTR = ['friend', 'self']
WEIBO_URL_PATTERN = re.compile(r'https?://weibo\.com/(?:(\d+)/([^?#]+))|p/([^?#]+)')

# 平台处理策略配置
PLATFORM_CONFIG = {
    # 需要截图 + 提取 IP 的平台
    "ip_required": [
        "xiaohongshu.com",
        "douyin.com",
        "weibo.com",
    ],
    # 仅需要截图的平台
    "screenshot_only": [
        "kuaishou.com",
        "toutiao.com",
        "soulsmile.cn"
    ],
    # 需要使用移动端屏幕尺寸的平台
    "mobile_screen": [
        # "soulsmile.cn",
        # "kuaishou.com"
    ]
}